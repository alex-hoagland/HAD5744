ggplot(data=mydata,aes(x=exper,y=lwage)) + geom_point() +
theme_minimal() + labs(x="Experience (Years)",y="Wages") +
stat_smooth(method="lm", se=TRUE, fill=NA,
formula=y ~ poly(x, 3, raw=TRUE),colour="red")
# Higher order terms?
n <- 10 # You pick a polynomial
ggplot(data=mydata,aes(x=exper,y=lwage)) + geom_point() +
theme_minimal() + labs(x="Experience (Years)",y="Wages") +
stat_smooth(method="lm", se=TRUE, fill=NA,
formula=y ~ poly(x, n, raw=TRUE),colour="red")
mydata <- mydata %>% mutate(wage=exp(lwage))
ggplot(mydata,aes(x=educ,y=wage)) + geom_point() + theme_minimal()
m1 <- lm(lwage ~ educ + exper + black + married + nearc4 + educ:black + exper:black, data=mydata)
msummary(list("naive"=m1),
stars=c('*' = .1, '**' = .05, '***' = .01))
# Same model with robust standard errors
msummary(list("naive"=m1,"robust"=m1),
vcov=c("classical","robust"),
stars=c('*' = .1, '**' = .05, '***' = .01))
mydata$state <- unlist(causaldata::abortion[1:3010,1])
m1 <- lm(lwage ~ educ + exper + black + married + nearc4 + educ:black + exper:black, data=mydata)
msummary(list("naive"=m1,"robust"=m1,"Clustered"=m1),
vcov=c("classical","robust",~state),
stars=c('*' = .1, '**' = .05, '***' = .01))
load("C:/Users/alexh/Dropbox/IBNR_MoralHazard_Github/2_Data/Model/AllYears_Complete_2022-09-23.Rdata")
head(mydata_t)
# Question: What is the effect of education on wages?
mydata <- causaldata::close_college
oddsplot(nearc4, educ)
install.packages('oddsplot')
install.packages('OddsPlotty')
library(OddsPlotty)
library(mlbench)
library(caret)
lirary(tibble)
library(tibble)
library(ggplot2)
library(e1071)
library(ggthemes)
data("BreastCancer", package = "mlbench")
#Use complete cases of breast cancer
breast <- BreastCancer[complete.cases(BreastCancer), ] #Create a copy
breast <- breast[, -1]
head(breast, 10)
#Convert the class to a factor - Beningn (0) and Malignant (1)
breast$Class <- factor(breast$Class)
str(breast)
for(i in 1:9) {
breast[, i] <- as.numeric(as.character(breast[, i]))
}
#Loops through the first columns - 1 to 9 and changes them from factors to a numerical representation
str(breast)
library(caret)
glm_model <- caret::train(Class ~ .,
data = breast,
method = "glm",
family = "binomial")
summary(glm_model)
plotty <- OddsPlotty::odds_plot(glm_model$finalModel,
title = "Odds Plot",
subtitle = "Showing odds of cancer based on various factors")
plotty$odds_plot
plotty$odds_data
tidy_odds_plot <- OddsPlotty::odds_plot(fitted_logistic_model$fit,
title="TidyModels Odds Plot",
point_col = "#6b95ff",
h_line_color = "red")
knitr::opts_chunk$set(echo = TRUE)
################################################################################
# I like to include several additional notes in the header of my files here:
#
# Last modified: 8/11/2022
#
### PURPOSE:
# Lecture 3 code and output file
#
### NOTES:
# - uses the Tidyverse package and Dplyr
################################################################################
### 0. Load the packages we will need for this file ####
library(tidyverse) # load the installed package for each new session of R
library(broom)
library(faux) # Useful package for simulating data
library(modelsummary) # For making regression tables
library(causaldata) # Useful toy data sets
library(here) # Helpful in working with directories and projects
set.seed(03262020) # Setting the seed helps to make random number generators give us the same numbers across machines
################################################################################
mydata <- causaldata::close_college
m_levels <- lm(wage ~ educ + exper, data=mydata)
# First pass: regression with education and experience as covariates
mydata <- mydata %>% mutate(wage = exp(lwage))
m_levels <- lm(wage ~ educ + exper, data=mydata)
m_transformed <- lm(wage ~ educ + 12*exper, data=mydata)
# First pass: regression with education and experience as covariates
mydata <- mydata %>% mutate(exper_m = exper * 12)
m_levels <- lm(wage ~ educ + exper, data=mydata)
m_transformed <- lm(wage ~ educ + 12*exper, data=mydata)
m_transformed <- lm(wage ~ educ + exper_m, data=mydata)
msummary(list("Base"=m_levels, "Months of Experience"=m_transformed),
stars=c('*' = .1, '**' = .05, '***' = .01))
2.095*12
0.115/2.095
1.383/25.142
View(mydata)
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rnorm(nrow(mydata),mean=1,sd=.1))
hist(mydata$weight)
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rexp(nrow(mydata),mean=1,sd=.1))
?rexp
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rexp(nrow(mydata),rate=1))
hist(mydata$weight)
m_weighted <- lm(wage ~ educ + exper, data=mydata, weights = weight)
msummary(list("Base"=m_levels, "Weighted Regression"=m_weighted),
stars=c('*' = .1, '**' = .05, '***' = .01))
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rexp(nrow(mydata),rate=2))
m_weighted <- lm(wage ~ educ + exper, data=mydata, weights = weight)
msummary(list("Base"=m_levels, "Weighted Regression"=m_weighted),
stars=c('*' = .1, '**' = .05, '***' = .01))
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rexp(nrow(mydata),rate=5))
m_weighted <- lm(wage ~ educ + exper, data=mydata, weights = weight)
msummary(list("Base"=m_levels, "Weighted Regression"=m_weighted),
stars=c('*' = .1, '**' = .05, '***' = .01))
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rexp(nrow(mydata),rate=50))
m_weighted <- lm(wage ~ educ + exper, data=mydata, weights = weight)
msummary(list("Base"=m_levels, "Weighted Regression"=m_weighted),
stars=c('*' = .1, '**' = .05, '***' = .01))
hist(mydata$weight)
# Now suppose this were survey data and each individual had a survey weight assigned. How could we weight observations to make our regression "nationally representative"?
# NOTE: this is fake data!
mydata <- mydata %>% mutate(weight = rexp(nrow(mydata),rate=1/50))
m_weighted <- lm(wage ~ educ + exper, data=mydata, weights = weight)
msummary(list("Base"=m_levels, "Weighted Regression"=m_weighted),
stars=c('*' = .1, '**' = .05, '***' = .01))
hist(mydata$weight)
state.x77
test <- state.x77
test %>% ggplot(aes(x=Illiteracy, y=Life)) + geom_point()
state.x77
state.x77 %>% ggplot(aes(x=Illiteracy))
state.x77 %>% as.data.frame() %>% ggplot(aes(x=Illiteracy))
state.x77 %>% as.data.frame() %>% ggplot(aes(x=Illiteracy,y=Life Exp))
state.x77 %>% as.data.frame() %>% names()
state.x77 %>% as.data.frame() %>% ggplot(aes(x=Illiteracy,y="Life Exp")) + geom_point()
state.x77 %>% as.data.frame() %>% ggplot(aes(x=Illiteracy,y=Life Exp)) + geom_point()
test <- as.data.frame(state.x77)
names(test)
names(test)[4]
names(test)[4] <- "LifeExp"
state.x77 %>% as.data.frame() %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(size=Population)
names(test)
test %>% ggplot(aes(x=Illiteracy,y=LifeExp,size=Population)) + geom_point()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp,size=Population)) + geom_point() + theme_minimal() + geom_smooth()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=population)) + theme_minimal() + geom_smooth()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_lm()
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_lm(method='lm')
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm')
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm') + geom_smooth(method="lm",mapping=aes(weight=Population))
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm') + geom_smooth(method="lm",mapping=aes(weight=Population), color='black')
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm') + geom_smooth(method="lm",mapping=aes(weight=Population), color='green')
test %>% ggplot(aes(x=Illiteracy,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm', color='red') + geom_smooth(method="lm",mapping=aes(weight=Population), color='green')
test %>% ggplot(aes(x=Murder,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm', color='red') + geom_smooth(method="lm",mapping=aes(weight=Population), color='green')
test %>% ggplot(aes(x=Murder,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal()
test %>% ggplot(aes(x=Murder,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm', color='red')
test %>% ggplot(aes(x=Murder,y=LifeExp)) + geom_point(aes(size=Population)) + theme_minimal() + geom_smooth(method='lm', color='red') + geom_smooth(method="lm",mapping=aes(weight=Population), color='green')
install.packages("RM.weights")
library(RM.weights)
RM.weights::data.FAO_country1
data.FAO_country1
data("data.FAO_country1")
# first, an example with food insecurity
data("data.FAO_country1")
# first, an example with food insecurity
faodata <- data("data.FAO_country1")
# base regression
fao_levels <- lm(HUNGRY ~ education + gender + age + urbanrural, data=data.FAO_country1)
# what if we measure age in months?
data.FAO_country1 <- data.FAO_country1 %>% mutate(age_m = age * 12)
fao_transformed <- lm(HUNGRY ~ education + gender + age_m + urbanrural, data=data.FAO_country1)
msummary(list("Base"=fao_levels, "Age in Months"=fao_transformed),
stars=c('*' = .1, '**' = .05, '***' = .01))
?msummary
msummary(list("Base"=fao_levels, "Age in Months"=fao_transformed),
stars=c('*' = .1, '**' = .05, '***' = .01), fmt=5)
# Now what if we weight using the survey weights ("wt")
fao_weighted <- lm(HUNGRY ~ education + gender + age + urbanrural,
data=data.FAO_country1, weights=wt)
msummary(list("Base"=fao_levels, "Weighted Regression"=fao_weighted),
stars=c('*' = .1, '**' = .05, '***' = .01)) # what might we interpret here?
# First example: case study on food security
fao_2 <- lm(HUNGRY ~ education + gender + age + urbanrural +
education:gender,
data=data.FAO_country1, weight=wt)
# What if we had left out the main effect?
fao_3 <- lm(HUNGRY ~ age + urbanrural +
education:gender,
data=data.FAO_country1, weight=wt)
msummary(list(fao_levels,fao_2, fao_3),
stars=c('*' = .1, '**' = .05, '***' = .01))
knitr::opts_chunk$set(echo = TRUE)
### 0. Load the packages we will need for this file ####
library(tidyverse) # load the installed package for each new session of R
library(broom)
library(modelsummary) # For making regression tables
library(here) # Helpful in working with directories and projects
################################################################################
# load the data
mydata <- read.csv("nhis_data.csv")
names(mydata) # documentation available on IPUMS
# let's do a simple regression with the base controls
# we don't have surgical-level data here, but person-level. Let's just do health
mydata <- mydata %>% mutate(HEALTH = ifelse(HEALTH >= 6, NA, HEALTH)) # higher numbers --> worse health
mydata <- mydata %>% mutate(AGE = ifelse(AGE >= 100, NA, AGE))
hist(mydata$HEALTH) # what does this tell us?
mydata <- mydata %>% mutate(FEM = ifelse(SEX == 2, 1, 0),
EMP = ifelse(EMPSTAT == 100, 1, 0),
MEDICAID = ifelse(HIMCAIDE == 2, 1, 0),
PRIVATE = ifelse(HIPRIVATE == 2, 1, 0))
regdata <- mydata %>% filter(MEDICAID == 1 | PRIVATE == 1) # what are we doing here? why?
# what if we measure age in months?
# regdata <- regdata %>% mutate(age_m = AGE * 12)
# replication_reg2 <- lm(HEALTH ~ MEDICAID + age_m + FEM + EMP, data=regdata)
# msummary(list("Base"=replication_reg, "Age in Months"=replication_reg2),
#          stars=c('*' = .1, '**' = .05, '***' = .01), fmt=5)
# is there a scaling we would want to do? What if we convert health so that negative coefficients indicated worse health
regdata <- regdata %>% mutate(HEALTH = (HEALTH * -1)+6)
replication_reg <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP, data=regdata)
# Now what if we weight using the survey weights ("SAMPWEIGHT")
replication_reg3 <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base"=replication_reg, "Weighted Regression"=replication_reg3),
stars=c('*' = .1, '**' = .05, '***' = .01)) # what might we interpret here?
# lm(HEALTH ~ MEDICAID + AGE + FEM + EMP)
# should we transform any of these RHS variables?
# what about the LHS variable
logreg <- lm(log(HEALTH) ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Levels"=replication_reg3, "Log(Outcome)"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
hist(log(mydata$HEALTH)) # note: why are we doing this?
# are there RHS variables we could include that should be transformed?
# what about the LHS variable
logreg2 <- lm(log(HEALTH) ~ MEDICAID + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("(1)"=logreg, "(2)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# let's pick a group
names(mydata)
# this example stratifies across smokers but we can pick any of the others
regdata <- regdata %>% mutate(smoker = ifelse(SMOKEV == 2, 1, 0))
# Basic example
logreg2 <- lm(log(HEALTH) ~ MEDICAID + smoker + MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# What if we had left out the main effect?
logreg2_wrong <- lm(log(HEALTH) ~ MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2, "Interaction Model (bad!)"=logreg2_wrong),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
regdata %>% group_by(AGE) %>% summarize(HEALTH=mean(HEALTH,na.rm=T)) %>%
ggplot(aes(x=AGE,y=HEALTH)) + geom_point() + theme_minimal() +
labs(x="Age (Years)",y="Average HEALTH") # what does this show? Do we need a nonlinear effect?
packageVersion("rlang")
remotes::install_version('rlang',"1.1.7")
remotes::install_version('rlang',"1.1.7")
knitr::opts_chunk$set(echo = TRUE)
### 0. Load the packages we will need for this file ####
library(tidyverse) # load the installed package for each new session of R
library(broom)
library(modelsummary) # For making regression tables
library(here) # Helpful in working with directories and projects
################################################################################
# load the data
mydata <- read.csv("nhis_data.csv")
names(mydata) # documentation available on IPUMS
# let's do a simple regression with the base controls
# we don't have surgical-level data here, but person-level. Let's just do health
mydata <- mydata %>% mutate(HEALTH = ifelse(HEALTH >= 6, NA, HEALTH)) # higher numbers --> worse health
mydata <- mydata %>% mutate(AGE = ifelse(AGE >= 100, NA, AGE))
hist(mydata$HEALTH) # what does this tell us?
mydata <- mydata %>% mutate(FEM = ifelse(SEX == 2, 1, 0),
EMP = ifelse(EMPSTAT == 100, 1, 0),
MEDICAID = ifelse(HIMCAIDE == 2, 1, 0),
PRIVATE = ifelse(HIPRIVATE == 2, 1, 0))
regdata <- mydata %>% filter(MEDICAID == 1 | PRIVATE == 1) # what are we doing here? why?
# what if we measure age in months?
# regdata <- regdata %>% mutate(age_m = AGE * 12)
# replication_reg2 <- lm(HEALTH ~ MEDICAID + age_m + FEM + EMP, data=regdata)
# msummary(list("Base"=replication_reg, "Age in Months"=replication_reg2),
#          stars=c('*' = .1, '**' = .05, '***' = .01), fmt=5)
# is there a scaling we would want to do? What if we convert health so that negative coefficients indicated worse health
regdata <- regdata %>% mutate(HEALTH = (HEALTH * -1)+6)
replication_reg <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP, data=regdata)
# Now what if we weight using the survey weights ("SAMPWEIGHT")
replication_reg3 <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base"=replication_reg, "Weighted Regression"=replication_reg3),
stars=c('*' = .1, '**' = .05, '***' = .01)) # what might we interpret here?
# library(gganimate)
#
# # Main data
# animatedata <- data.frame(x=rnorm(n=100,mean=5,sd=2))
# animatedata <- animatedata %>% mutate(y=-.5*x+rnorm(n=100,mean=0,sd=.25))
#
# # Duplicate each row (for transition in animation)
# animatedata <- animatedata %>% bind_rows(animatedata)
# animatedata$transition <- 0
# animatedata[101:200,]$transition <- 1
#
# # Add (one big) outlier to the second set of data
# animatedata[201,] <- c(20,-20,1)
#
# # Scatter plot with outlier
# ggplot(animatedata,aes(x=x,y=y)) + geom_point() + theme_classic()
#
# # Scatter plot without outlier
# animatedata %>% filter(transition == 0) %>% ggplot(aes(x=x,y=y)) + geom_point() + theme_classic()
#
# # To make animated data, need to duplicate rows for all data points in both states (add/subtract only outlier)
#
# animfig <- ggplot(animatedata,aes(x=x,y=y)) +
#   geom_point() +
#   geom_smooth(data=animatedata,aes(x=x,y=y),method='lm') +
#   # Here comes the gganimate code
#   transition_states(
#     transition,
#     transition_length = 1,
#     state_length = 1
#   ) +
#   enter_fade() +
#   exit_shrink() +
#   ease_aes('linear') +
#   theme_classic()
# animate(animfig)
# anim_save(filename=here("RegressionOutlier.gif"),animation=animfig)
# lm(HEALTH ~ MEDICAID + AGE + FEM + EMP)
# should we transform any of these RHS variables?
# what about the LHS variable
logreg <- lm(log(HEALTH) ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Levels"=replication_reg3, "Log(Outcome)"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
hist(log(mydata$HEALTH)) # note: why are we doing this?
# are there RHS variables we could include that should be transformed?
# what about the LHS variable
logreg2 <- lm(log(HEALTH) ~ MEDICAID + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("(1)"=logreg, "(2)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# let's pick a group
names(mydata)
# this example stratifies across smokers but we can pick any of the others
regdata <- regdata %>% mutate(smoker = ifelse(SMOKEV == 2, 1, 0))
# Basic example
logreg2 <- lm(log(HEALTH) ~ MEDICAID + smoker + MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# What if we had left out the main effect?
logreg2_wrong <- lm(log(HEALTH) ~ MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2, "Interaction Model (bad!)"=logreg2_wrong),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
regdata %>% group_by(AGE) %>% summarize(HEALTH=mean(HEALTH,na.rm=T)) %>%
ggplot(aes(x=AGE,y=HEALTH)) + geom_point() + theme_minimal() +
labs(x="Age (Years)",y="Average HEALTH") # what does this show? Do we need a nonlinear effect?
# add a squared term for age
regdata <- regdata %>% mutate(age2 = AGE*AGE)
logreg2 <- lm(log(HEALTH) ~ MEDICAID + AGE + age2 + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Nonlinear Model (logs)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# Same model with robust standard errors
msummary(list("Base"=logreg, "Robust SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust")) # how do we interpret this?
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~REGION)) # how do we interpret this?
names(mydata)
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~REGION+STRATA)) # how do we interpret this?
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~REGION+YEAR)) # how do we interpret this?
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~YEAR)) # how do we interpret this?
table(mydata$YEAR)
names(mydata)
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~PSU)) # how do we interpret this?
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~REGION+PSU)) # how do we interpret this?
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~REGION)) # how do we interpret this?
knitr::opts_chunk$set(echo = TRUE)
### 0. Load the packages we will need for this file ####
library(tidyverse) # load the installed package for each new session of R
library(broom)
library(modelsummary) # For making regression tables
library(here) # Helpful in working with directories and projects
################################################################################
# load the data
mydata <- read.csv("nhis_data.csv")
names(mydata) # documentation available on IPUMS
# let's do a simple regression with the base controls
# we don't have surgical-level data here, but person-level. Let's just do health
mydata <- mydata %>% mutate(HEALTH = ifelse(HEALTH >= 6, NA, HEALTH)) # higher numbers --> worse health
mydata <- mydata %>% mutate(AGE = ifelse(AGE >= 100, NA, AGE))
hist(mydata$HEALTH) # what does this tell us?
mydata <- mydata %>% mutate(FEM = ifelse(SEX == 2, 1, 0),
EMP = ifelse(EMPSTAT == 100, 1, 0),
MEDICAID = ifelse(HIMCAIDE == 2, 1, 0),
PRIVATE = ifelse(HIPRIVATE == 2, 1, 0))
regdata <- mydata %>% filter(MEDICAID == 1 | PRIVATE == 1) # what are we doing here? why?
# what if we measure age in months?
# regdata <- regdata %>% mutate(age_m = AGE * 12)
# replication_reg2 <- lm(HEALTH ~ MEDICAID + age_m + FEM + EMP, data=regdata)
# msummary(list("Base"=replication_reg, "Age in Months"=replication_reg2),
#          stars=c('*' = .1, '**' = .05, '***' = .01), fmt=5)
# is there a scaling we would want to do? What if we convert health so that negative coefficients indicated worse health
regdata <- regdata %>% mutate(HEALTH = (HEALTH * -1)+6)
replication_reg <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP, data=regdata)
# Now what if we weight using the survey weights ("SAMPWEIGHT")
replication_reg3 <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base"=replication_reg, "Weighted Regression"=replication_reg3),
stars=c('*' = .1, '**' = .05, '***' = .01)) # what might we interpret here?
# load the data
mydata <- read.csv("nhis_data.csv")
names(mydata)
# is there a scaling we would want to do? What if we convert health so that negative coefficients indicated worse health
regdata <- regdata %>% mutate(HEALTH = (HEALTH * -1)+6)
replication_reg <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP, data=regdata)
# Now what if we weight using the survey weights ("SAMPWEIGHT")
replication_reg3 <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
# Now what if we weight using the survey weights ("SAMPWEIGHT")
replication_reg3 <- lm(HEALTH ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base"=replication_reg, "Weighted Regression"=replication_reg3),
stars=c('*' = .1, '**' = .05, '***' = .01)) # what might we interpret here?
hist(regdata$EMP)
hist(regdata$HOURSWRK)
hist(log(regdata$HOURSWRK+1))
# what about the LHS variable
logreg <- lm(log(HEALTH) ~ MEDICAID + AGE + FEM + EMP,
data=regdata, weights=SAMPWEIGHT)
msummary(list("Levels"=replication_reg3, "Log(Outcome)"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
hist(log(mydata$HEALTH)) # note: why are we doing this?
# are there RHS variables we could include that should be transformed?
# what about the LHS variable
logreg2 <- lm(log(HEALTH) ~ MEDICAID + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("(1)"=logreg, "(2)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
msummary(list("Levels"=replication_reg3, "Log(Outcome)"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
msummary(list("(1)"=logreg, "(2)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# let's pick a group
names(mydata)
# this example stratifies across smokers but we can pick any of the others
regdata <- regdata %>% mutate(smoker = ifelse(SMOKEV == 2, 1, 0))
# Basic example
logreg2 <- lm(log(HEALTH) ~ MEDICAID + smoker + MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# What if we had left out the main effect?
logreg2_wrong <- lm(log(HEALTH) ~ MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2, "Interaction Model (bad!)"=logreg2_wrong),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# let's pick a group
names(mydata)
mean(mydata$SMOKEV)
mean(mydata$smoker)
# this example stratifies across smokers but we can pick any of the others
regdata <- regdata %>% mutate(smoker = ifelse(SMOKEV == 2, 1, 0))
mean(regdata$smoker)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
# What if we had left out the main effect?
logreg2_wrong <- lm(log(HEALTH) ~ MEDICAID:smoker + AGE + FEM + EMP + log(HOURSWRK+1),
data=regdata, weights=SAMPWEIGHT)
msummary(list("Base Model (logs)"=logreg, "Interaction Model (logs)"=logreg2, "Interaction Model (bad!)"=logreg2_wrong),
stars=c('*' = .1, '**' = .05, '***' = .01)) # how do we interpret this?
msummary(list("Base"=logreg, "Robust SEs"=logreg, "Clustered SEs"=logreg),
stars=c('*' = .1, '**' = .05, '***' = .01),
vcov=c("classical","robust", ~REGION)) # how do we interpret this?
